---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.1'
      jupytext_version: 1.1.6
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Hierarchical Indexing

```python
import pandas as pd
import numpy as np
```

```python
index = [('California', 2000), ('California', 2010),
         ('New York', 2000), ('New York', 2010),
         ('Texas', 2000), ('Texas', 2010)]
populations = [33871648, 37253956,
               18976457, 19378102,
               20851820, 25145561]
pop = pd.Series(populations, index=index)
pop
```

```python
pop[('California', 2010):('Texas', 2000)]
```

```python
pop[[i for i in pop.index if i[1] == 2010]]
```

```python
index = pd.MultiIndex.from_tuples(index)
index
```

```python
pop = pop.reindex(index)
pop
```

```python
pop[:, 2010]
```

```python
pop_df = pop.unstack()
pop_df
```

```python
pop_df.stack()
```

```python
pop_df = pd.DataFrame({'total': pop,
                       'under18': [9267089, 9284094,
                                   4687374, 4318033,
                                   5906301, 6879014]})
pop_df
```

```python
f_u18 = pop_df['under18'] / pop_df['total']
f_u18.unstack()
```

```python
df = pd.DataFrame(np.random.rand(4, 2),
                  index=[['a', 'a', 'b', 'b'], [1, 2, 1, 2]],
                  columns=['data1', 'data2'])
df
```

```python
data = {('California', 2000): 33871648,
        ('California', 2010): 37253956,
        ('Texas', 2000): 20851820,
        ('Texas', 2010): 25145561,
        ('New York', 2000): 18976457,
        ('New York', 2010): 19378102}
pd.Series(data)
```

```python
pd.MultiIndex.from_arrays([['a', 'a', 'b', 'b'], [1, 2, 1, 2]])
```

```python
pd.MultiIndex.from_tuples([('a', 1), ('a', 2), ('b', 1), ('b', 2)])
```

```python
pd.MultiIndex.from_product([['a', 'b'], [1, 2]])
```

```python
pd.MultiIndex(levels=[['a', 'b'], [1, 2]],
              labels=[[0, 0, 1, 1], [0, 1, 0, 1]])
```

```python
pop.index.names = ['state', 'year']
pop
```

```python
# hierarchical indices and columns
index = pd.MultiIndex.from_product([[2013, 2014], [1, 2]],
                                   names=['year', 'visit'])
columns = pd.MultiIndex.from_product([['Bob', 'Guido', 'Sue'], ['HR', 'Temp']],
                                     names=['subject', 'type'])

# mock some data
data = np.round(np.random.randn(4, 6), 1)
data[:, ::2] *= 10
data += 37

# create the dataframe
health_data = pd.DataFrame(data, index=index, columns=columns)
health_data
```

```python
health_data['Guido']
```

```python
pop
```

```python
pop['California', 2000]
```

```python
pop['California']
```

```python
pop.loc['California':'New York']
```

```python
pop[:, 2000]
```

```python
pop[pop > 22000000]
```

```python
pop[['California', 'Texas']]
```

```python
health_data
```

```python
health_data['Guido', 'HR']
```

```python
health_data.iloc[:2, :2]
```

```python
health_data.loc[:, ('Bob', 'HR')]
```

```python
health_data.loc[(:, 1), (:, 'HR')]
```

```python
idx = pd.IndexSlice
health_data.loc[idx[:, 1], idx[:, 'HR']]
```

```python
index = pd.MultiIndex.from_product([['a', 'c', 'b'], [1, 2]])
data = pd.Series(np.random.rand(6), index=index)
data.index.names = ['char', 'int']
data
```

```python
try:
    data['a':'b']
except KeyError as e:
    print(type(e))
    print(e)
```

```python
data = data.sort_index()
data
```

```python
data['a':'b']
```

```python
pop.unstack(level=0)
```

```python
pop.unstack(level=1)
```

```python
pop.unstack().stack()
```

```python
pop_flat = pop.reset_index(name='population')
pop_flat
```

```python
pop_flat.set_index(['state', 'year'])
```

```python
health_data
```

```python
data_mean = health_data.mean(level='year')
data_mean
```

```python
data_mean.mean(axis=1, level='type')
```
